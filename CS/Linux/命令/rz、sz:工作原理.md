# rz、sz:工作原理

我们知道用linux命令rz/sz可以通过一些终端软件如secureCRT等在linux服务器与本地windows之间传文件。在服务器上rz一下，在本地windows下就跳出一个窗口，选择文件后就传到了服务器上；而在服务器上用sz命令sz一个文件，在本地电脑硬盘上就有了这个文件。用起来是很方便，但是总感觉很神奇。

关于其可能的工作原理，之前猜测过，感觉是这样：用secureCRT等远程登录的时候，其实就是通过ssh方式，连接了远程主机上的sshd，也就是相当于用sshd-client 在于sshd 交互而已，而这个sshd-client就是secureCRT；这样，sz/rz工作的时候，也只能是通过这条通路。具体怎样通过这条通路传的，大概是这样：sz 一个文件的时候，就像是cat 一个文件一样，本来应该在本地窗口显示出一堆乱码，但是正巧这堆乱码符合某种格式（就是zModem这种sz/rz所采用的协议格式），被secureCRT识破了，认出了其实是sz命令发起的，于是保存成本地一个文件。换句话说，如果一个文件内容正好是这样的内容，那么cat出后，在本地也必然会保存出一个文件的。对于rz呢，也是同样的道理，rz 执行后直接往标准输出打印一些内容，这些内容格式古怪，正好被secureCRT所识别出来，然后弹窗，并把本地文件传过去，就像是用户的键入内容一样被rz命令接收。

这只是猜测，具体不很明了。但是通过做了几个实验，发现差不多是这个意思。我登上了A，然后ssh跳到了B，再ssh跳到了C，然后在C上做sz/rz操作，发现B机器上的网卡流量急剧变大，而sz/rz操作结束后，B机器上的网卡流量又恢复正常。那么说明这个文件传输肯定是通过上面所说的通道的。

致于上面分析的更细节内容，用 strace rz 看了下，然后发现一些可疑的地方，然后总结出了以下一句命令：
```
echo -e  "**\30B0100000023be50\r\212\21";
```
会发现，在secureCRT上跳出了文件上传对话框。这说明上面分析是对的。
