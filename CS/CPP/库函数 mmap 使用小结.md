# 库函数 mmap 使用小结

- 如果用 MAP_FIXED 以创建一块固定基地址的大内存，有可能返回地址不满足要求或失败，这时候一个原因是是资源限制导致，所以请先 ulimit -a 看看；没问题的话可以看看内核，较早的内核支持的虚拟地址空间比较小。
- 如果希望mmap到一个固定文件，且内存变的时候文件也变，那么请mmap的时候指定MAP_SHARED。
- 如果mmap到一个100M的文件，希望内存扩大后，文件自动扩大，那么请用ftruncate扩大文件才扩内存，否则内存变大后不能自动反映到文件上。
- 如果mmap时没有指定 PROT_WRITE，那么这块内存就是只读的。有一些隐藏的操作会失败，导致出core。要注意。比如如果一个只读的多线程安全map如果所有数据都放到了这块内存上，那么有可能出问题，因为加锁解锁会读内存。
