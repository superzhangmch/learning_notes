# CRF++ 用于切词的试验

久闻CRF大名，但是一直没有试用过。今天特意试用以切词，以了解其效果。所用CRF工具是CRF++。最后效果真的大大超出意料。特作记录，算是佐证下其神效。

用别的切词工具，对1万个某领域内的句子切词，以构造样本：
```
天 B
天 E
拉 B
肚 M
子 E
怎 B
么 E
弄 S
的 S

膝 B
盖 E
疼 B
痛 E
大 B
概 E
多 B
少 E
時 S
间 S
能 S
好 S
...
```
其中S表示单字成词；B=WordBegin，E=WordEnd，M=WordMiddle。

template 文件：
```
# Unigram
U00:%x[-2,0]
U01:%x[-1,0]
U02:%x[0,0]
U03:%x[1,0]
U04:%x[2,0]
U05:%x[-2,0]/%x[-1,0]/%x[0,0] # 这里的"/"，可以看做是and关系。换做其他字符，似乎都work；
U06:%x[-1,0]/%x[0,0]/%x[1,0]
U07:%x[0,0]/%x[1,0]/%x[2,0]
U08:%x[-1,0]/%x[0,0]
U09:%x[0,0]/%x[1,0]
# Bigram
B
```
这个怎么解读，可以看crf++的文档。大概说，必须以U开头或B开头。B开头表示构造特征函数的时候，会同时考虑上一个标注和本标注，U开头的只考虑本char下的标注。

> $p(y|x, \lambda) \propto \exp(\sum_j [{\lambda_j \cdot t_j(y_{i-1}, y_i, x, i)}]+ \sum_k [{\mu_k \cdot s_k(y_i, x, i)}])$

从CRF的公式看，B其实就是对应exp 内第一项 $t_j(y_{i-1}, y_i)$ ，U对应的是第二项 $s_k(y_i,...)$ 。另外，一般说CRF能兼顾上下文，就指的是模板能把上下文配进去（对应：特征函数中，x整体以及x中的下标——表示当前token——都是传进去了的）。

明白了模板文件每行的含义，就可以自己添加或增删符合自己需要的规则条目了。

<br>

就这样，最后的效果真的大大超出了预期:
> 有/糖尿病/，/我/想/给/她/买点/吃/的/东西/，/平常/就/可以/吃/的/，/能/买点/什么/呢/？/糖尿病/可以/吃什么/水果/？/不/可以/吃什么/水果/糖尿病/能/吃什么

训练过程中一些输出说明：
- terr: term 错误率
- serr: sentence 错误率
- obj：可以认为是目标函数取值
- diff: obj的值变化率

工具：
- crfpp下载地址：http://vdisk.weibo.com/s/y-ILf0eaXLN5T
- 容易切错的case集：http://blog.sina.com.cn/s/blog_c3caf23b0101b08f.html
