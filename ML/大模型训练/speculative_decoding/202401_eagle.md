# 《EAGLE: Speculative Sampling Requires Rethinking Feature Uncertainty》 https://arxiv.org/pdf/2401.15077

eagle 有 v1，v2，v3 三篇 paper。这里看 v1。

## 整体流程

<img width="1208" height="1138" alt="image" src="https://github.com/user-attachments/assets/84e18bc2-c70b-44d1-a8f7-5d728ba1e128" />

### 一、draft model：轻量自回归 head
在原始 LLM 上增加轻量的 draft 自回归 head。这点和 medusa 一样，但是 medusa 是多个并行 heads，分别预测不同位置的 tokens，从而实现多候选 seq 的生成。 eagle 的 draft head 是自回归的，只需要一个 head。

多候选怎么生成：draft model 每次生成一个 token的时候，要选取top K 个token，然后下一个 forward 自回归生成的时候，对这 K 个 token 都要作下一token生成。如是循环。这样就构建了一颗 tree 结构（如上图之下）。

### 二、verify 怎么做

target model 怎么计算 draft model 的结果的 logits 概率：和 medusa 一样用 tree attention

### 三、怎么对 draft 结果作 accept

用原生 speculative decoding 那样的拒绝采样法，保证结果的分布和原 LLM 一致。

----

