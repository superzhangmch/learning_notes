# C++/C: extern "C"

因为c与c++ 在把函数名转化为编译产物中的符号的时候的转化规则不同，为了把二者打通，乃引入了extern "C"，用于二者互相调用。特别地，c++编译的库文件要输出时，或许可能被dlopen等动态引用的时候，需要extern "C"来打通。

因此c代码中是用不到 extern "C"的。只有c++ 代码中会适时使用。

一般地 c++ 中用extern "C"的时候，或用于修饰函数定义，或用于修饰函数的声明：用于后者的时候，即使函数定义没有被extern"C"修饰到，也会用extern "C"方式编译。用于前者的时候，只作用于函数头中的函数名，对于函数体内的函数调用，则仿佛没用extern "C"一样，仍然是按正常方式处理。

这样：

### (1). c 代码中调用c++函数的时候：

或者令 c++ 函数整个地被extern "C"包起来，或者令c++中头文件被extern "C"修饰，然后编译c++代码，使得生产c风格的函数接口。这样子的话，该函数就没法被c++代码调用了，所以如果希望能被c已经c++都调用到，就需要保持原c++函数不变，另写一个函数把原函数包起来，并用extern "C"修饰新函数。也就是这样：

```int original_func_for_cpp(int a)
{
    return a +1;
}
int new_func_for_c(int a) {
    return original_func_for_cpp(a);
}
```

### (2). c++ 中调用c函数：

c++代码中把c函数的声明用 extern "C"声明一下就可以了。

如此就完成了两者的互相调用。
