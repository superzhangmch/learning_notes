GPS 卫星的下发信号非常弱，地面接收其实很不容易。采用的方法是直接序列扩频的 DSSS 技术。

----

序列扩频的操作，大约是这样：

### encode 并发送：
- 原始信号是 0、1 bit 序列
- 找一段固定长度的01 bit 序列，记为 S = {b1, b2, b3, ... b_N}, b_i取值为 0 或者 1
- 对原始序列做替代：如果是 1， 则用 S 取代，如果是 0， 则用S的反码序列来取代（逐位取反）
- 这样得到的二进制序列，就变成了 N 倍——序列扩展了。现在可以把这样的序列发出去了。

### 接收并 decode
- 接收到信号序列
- reveiver 也要知道扩频的序列 S，现在设法在接收到的序列中定位出同步点
- 找出同步点后，就可以把序列每 N 个分为1组了。每一组分别和序列 S 或其反码序列做对比，从而决定出原本是1还是0.
  - 对比的时候，必须要精确对得上，只要能差不多对上就行。所以 DSSS 技术抗干扰能力强，信号很弱也行。
 
----

对应到 GPS，原始码率是 50bps，扩到了 1M bps, 也就是每个 bit 扩成了 20460 个bit。而这 20460 bit 是由 1023 的 PN 扩频码，重复 20次得到的。

----

### 同步点怎么找：总结来说，就是滑动窗口找最佳匹配

by chatgpt：
 
这其实是 GPS 接收最关键也是最复杂的一步之一：**对齐（码同步）**。你问的是：

> 接收到的信号是个数组，怎么和 PN 码“对齐”起来？

我们下面来分步骤讲清楚，并且用你说的“数组”的思路来解释实际是怎么做的。

**接收到的信号是怎样的？**

接收端从天线接收的信号，经过下变频、采样、滤波后，就是一个**离散采样的数组**，比如这样：

```python
r = [0.3, -0.7, 0.2, 0.8, -1.1, ...]  # 数字中夹杂着PN码调制后的信号 + 噪声
```

我们现在的目标是：

> 找出这个信号中，**哪一段起始点**是某一颗 GPS 卫星对应的 PN 码（C/A码）的**正确对齐位置**。

**关键技术：相关性匹配（correlation search）**

1. 相关性计算的思想

你知道接收的 `r` 是：

```plaintext
r = 原始PN码序列 × 数据比特（+1/-1） + 噪声
```

你也知道某颗卫星的 **C/A码是固定的**（比如长度 1023）：

```python
pn_code = [+1, -1, +1, +1, -1, ...]  # 长度为1023
```

现在你就做一件事：

👉 把这个 `pn_code` 拿来，在 `r` 上滑动，一段一段去比相似度！

2. 滑动相关的过程（delay search）

你可以把这个过程理解为：

```python
best_score = 0
best_offset = 0

for delay in range(0, len(r) - len(pn_code)):
    window = r[delay : delay + len(pn_code)]
    score = dot_product(window, pn_code)
    if abs(score) > best_score:
        best_score = abs(score)
        best_offset = delay
```

这段代码其实就是：

> 在接收信号中找一段长度等于 PN 码的窗口，看看和 PN 码最“对得上”的位置在哪里。

如果 PN 码和这段窗口 **完全对齐**（即真正的卫星信号起始点），那么相关性值会很高（接近1023），而在其他位置会很低（接近0，像噪声）。

**更真实的过程（考虑采样率）**

现实中：

* 每个码片（chip）会被采样成多个点，比如 4倍过采样 → 每个 PN 码 1023 个 chip → 实际是 4092 点
* 所以搜索不是 1023 长度窗口，而是比如 4092 长度窗口

并且：

* 接收机并不知道当前的码相位和载波频率，所以还需要同时搜索**多种频率偏移（多普勒频移）**
* 通常用 **快速相关搜索**，比如使用 FFT 加速计算

**实际接收流程：两维搜索**

现实中手机或 GPS 芯片是在做一个 **二维搜索**：

| 搜索维度      | 内容               |
| --------- | ---------------- |
| 码延迟 Delay | 从接收到的数组中找出对齐起始点  |
| 多普勒频移     | 不同频率分量下尝试匹配 PN 码 |

组合搜索出来一个二维“热力图”，找出相关性最强的点，就是卫星信号的位置：

```plaintext
       多普勒频移 →
码延迟 ↓     [ ]  [ ]  [ ]  ...
             ↓
          找到最大相关峰 → 码同步 + 频率同步完成
```

----

### 手机 CDMA=码分多址 怎么做的

CDMA 手机通信也是用 DSSS（直接序列扩频）原理，但不同的是，多个用户（手机）用不同的扩频码在同一个频段上通信，彼此互不干扰。
