假如要对一个机器学习模型的效果做评估，只是抽取 n 条数据做评估，那么评估结果和真实的差异多大呢？
- 二分类 model: $1.96 \sqrt{\frac {p(1−p)​​} n }$
- 回归 model：95%置信衡量的误差 $1.96\cdot\frac{s}{\sqrt{n}}$， s 是n条数据上的单样本标准差

----

# 分类场景的准确率

假设有一个充分大的样本库（总体），记为 N，其中 N 非常大。一个模型在总体中的真实正确率为 p（未知）。从总体中随机抽取 n （比如100） 条样本，计算样本正确率 $\hat{p}$（即正确预测的样本数除以 n）。

### 问题

样本正确率 $\hat{p}$ 与真实正确率 $ p $ 的偏差 $|\hat{p} - p|$ 有多大？

### 答案

假设 p 是全样本的正确率，标准差衡量的正确率误差是 $\sqrt{\frac {p(1−p)​​} n }$ (二项分布的标准差/n)，95%置信衡量的误差是 $1.96 \sqrt{\frac {p(1−p)​​} n }$

| p | n | 标准差-偏差 | 95%置信-偏差 |
| -- | -- | --- | --- |
| 0.5 | 100 | 0.05 | 0.098 |
| 0.6 | 100 | 0.049 | 0.096 |
| 0.7 | 100 | 0.0458 | 0.0898 |
| 0.8 | 100 | 0.04 | 0.0784 |
| 0.9 | 100 | 0.03 | 0.0588 |
| 0.95 | 100 | 0.0218 | 0.0427 |
| 0.5 | 200 | 0.0354 | 0.0693 |
| 0.6 | 200 | 0.0346 | 0.0679 |
| 0.7 | 200 | 0.0324 | 0.0635 |
| 0.8 | 200 | 0.0283 | 0.0554 |
| 0.9 | 200 | 0.0212 | 0.0416 |
| 0.95 | 200 | 0.0154 | 0.0302 |
| 0.5 | 500 | 0.0224 | 0.0438 |
| 0.6 | 500 | 0.0219 | 0.0429 |
| 0.7 | 500 | 0.0205 | 0.0402 |
| 0.8 | 500 | 0.0179 | 0.0351 |
| 0.9 | 500 | 0.0134 | 0.0263 |
| 0.95 | 500 | 0.0097 | 0.0191 |
| 0.5 | 1000 | 0.0158 | 0.031 |
| 0.6 | 1000 | 0.0155 | 0.0304 |
| 0.7 | 1000 | 0.0145 | 0.0284 |
| 0.8 | 1000 | 0.0126 | 0.0248 |
| 0.9 | 1000 | 0.0095 | 0.0186 |
| 0.95 | 1000 | 0.0069 | 0.0135 |

### 为什么

怎么来的：

先把问题换成“掷硬币”，正面出现的概率是模型的真实正确率是 p。

**（一）、 $\sqrt{\frac {p(1−p)​​} n }$ 怎么来的**

先说答案：乃二项分布，而二项分布的标准差是 $\sqrt{np(1-p)}$ ，除以 n 可得。

详细如下：

你总共掷 (n) 次（比如 100 次），统计出多少次正面。

记： $X = \text{正面次数}$, 则 X 符合 二项分布（Binomial distribution）： $X \sim \mathrm{Binomial}(n, p)$, 样本正确率是： $\hat p = \frac{X}{n}$

二项分布的基本性质：

$$
\begin{cases}
\mathbb{E}[X] = np \\
\mathrm{Var}(X) = np(1-p)
\end{cases}
$$

因为 $\hat p = X / n$，那我们可以直接得到：

$$
\begin{cases}
\mathbb{E}[\hat p] = p \quad\text{（样本平均值是无偏的）} \\
\mathrm{Var}(\hat p) = \dfrac{p(1-p)}{n}
\end{cases}
$$

所以，抽样的 n 条样本的正确率的方差就是 (p(1-p)/n)。

**二、 95%置信衡量的误差 $1.96 \sqrt{\frac {p(1−p)​​} n }$ 怎么来的**

当 n 比较大（比如几十以上）时，二项分布可以近似为正态分布：

$$
\hat p \approx \mathcal{N}\left(p, \frac{p(1-p)}{n}\right)
$$

也就是说， $\hat p$ 在均值 p 附近波动，标准差就是上面这个。

于是：

* 大部分样本（约68%）会落在 $p \pm σ$， 其中 $σ = \sqrt {\frac{p(1−p)} n}$​​ 是标准差
* 约95% 会落在 $p \pm 1.96 σ$ （标准正态分布曲线（钟形曲线）在 ±1.96 个标准差（σ）范围内的面积 = 95%。，下面2.58同理）
* 约99% 会落在 $p \pm 2.58 σ$

所以（z 对应上面 1.96、2.58 这样的系数）：

$$
|\hat p - p| \lesssim z \sqrt{\frac{p(1-p)}{n}}
$$

----

# 平均得分场景

假设有一个充分大的样本库，记为 N，N 非常大。有一个模型可以给每个样本打某种 score（比如每条样本是作文，model 可以给作文打分）。从总体中随机抽取 n （比如100） 条样本，可以计算出在这 n 条数据上的平均score。 

### 问题是

n条样本上的平均得分，与真实平均得分的偏差有多大？怎么算

### 答案

**一、从标准差角度衡量**

令 σ 是单个样本分数的标准差，表示每条样本（比如每篇作文得分）围绕总体平均分 μ 的波动程度: $\sigma^2 = \mathrm{Var}(X) = \mathbb{E}[(X - \mu)^2]$。

假设你取 n 个独立样本 $X_1, X_2, ..., X_n$，
它们的平均值是： $\bar X = \frac{1}{n}\sum_{i=1}^n X_i$

因为方差具有可加性：

$$
\mathrm{Var}(\bar X) = \mathrm{Var}\left(\frac{1}{n}\sum X_i\right)
= \frac{1}{n^2}\sum \mathrm{Var}(X_i)
= \frac{1}{n^2}\cdot n\sigma^2
= \frac{\sigma^2}{n}
$$

取平方根，就是标准差（标准误）：

$$
\mathrm{SE} = \sqrt{\mathrm{Var}(\bar X)} = \frac{\sigma}{\sqrt{n}}
$$

也就是如果总体标准差是 σ，则平均值的波动 ∝ 1/√n。

**95%置信区间衡量**

均值的分布大致是正态的，约有 95% 的概率落在 ±1.96 个标准差范围内。1.96来源见上文。

所以： $\bar X \pm 1.96\cdot\frac{s}{\sqrt{n}}$, s是n条数据的标准差（可换成总体标准差，弱知）。
