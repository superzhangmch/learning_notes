# Lucene 怎样做数字范围搜索

Lucene 的一个原则是只靠倒排索引往外检索。这样即使对于数字，也是当做普通字符串看待，建立的索引。如果要进行数字范围搜索，比如100~200，那么只能是把 100~200之间的term全找出来，然后对这么多的拉链求并集，才能得到要求的结果。如果范围跨度很大，那么显然很可能会设计到非常多的term。

当然，一个解决思路是，建立一个特殊的数字倒排拉链，只要是数字就放进拉链，只是要求拉链中的元素格式是，同时按第一列排序。这样范围搜索的时候，就可以二分查找找到结果了；只是找到后需要做一遍按doc_id的去重。

<br>

Lucene 最终采用的是一个只用到倒排拉链的的解决方法，同时还减少了term个数。

大概的说，对一个数字，按其二进制表示方式分成多段，然后按trie方式建立范围索引。对于每一段，令后面的所有段取值为0，然后再把所有段拼接，得到一个新的数字（其实就是 ori_val & 0xfff0000 这样一下），就按此值作为term建一次倒排索引，对于每一段都会建一次索引。

比如 "0xf0000" 拉链本身，就代表了0f0000 ~ 0fffff 这个范围。

这样，一个范围搜索，就可以分解为一系列的个数比较少的特殊倒排索引的并集了。

参考：http://jimmee.iteye.com/blog/2041374
