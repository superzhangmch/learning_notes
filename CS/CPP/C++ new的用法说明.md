# C++: new的用法说明

C++ 中动态新建一个对象的时候，一般用new。如果要一次建立多个，那么可以用 new [] 。

在最终删除的时候，当然用 delete 或 delete[]。 new 与 delete 相对，new[] 与 delete[]相对。因此这里只谈new，不说delete。可以理解为，但是应该把 new 与 new[]当做完全不同的东西。如果new[] 使用  new_array 来表示，那么它们之间的差别就容易看出来多了。

在《effective C++》中，对于 new 与 new operator，以及带“括号”的版本是做了明确区别的。大概说operator 只负责内存非配，所以可以new算子重载的，也只是内存分配部分；而不能改变new /new [] 会适当调用构造函数这个事实。

鉴于 new 有 new 有 new [] 之区别。所以在复杂的new 表达式中需要对此保持清醒，否则就不知道到底 new 了多少个什么类型的数据，从而也不知道new返回的指针应该赋值给什么类型的指针。

例子如下：
```
int *p = new int[10];    // new 了 10 个 int 类型
int (*p)[200] = new int [100][200];    // new 了 100 个 int [200] 类型, &(int[200]) == int (*)[200]
int(**p)[10] = new (int (*[10])[10]);  // new 了 10 个 int(*)[10]; &( int(*)[10]) ==  int(**)[10]; 最外层括号不可省
new (int (*[1000000])[2000000][10]);   // new 了 1000000 个; 最外层括号不可省
new (int (***[1000000])[2000000][10]); // new 了 1000000 个; 最外层括号不可省
new (int (*[10])(int,int));            // new 函数指针数组。new 了 10 个 
```

以上这些都是 new []的。而

```
new int;
new int *;
new (int (*)[10]);
new (int ((*)[1000000])[2000000][10]);     // 最外层括号不可省
new (int ((***)[1000000])[2000000][10]);   // 最外层括号不可省
new (int (*)(int,int)); // new 函数指针     // 最外层括号不可省
```

等等，都是执行的不带**括号**版本的new。

特别注意以上在复杂情况下new 最外层的圆括号。这个是必不可少的。
